# ===========================================
# STAGING SITE PROTECTION - NEVER REMOVE
# ===========================================

# Prevent Search Engine Indexing
Header always set X-Robots-Tag "noindex, nofollow"
Header always set X-Frame-Options "DENY"
Header always set X-Content-Type-Options "nosniff"

# Block Search Engine Bots
<RequireAll>
    Require all granted
    Require not env block_spider
</RequireAll>

SetEnvIfNoCase User-Agent "googlebot" block_spider
SetEnvIfNoCase User-Agent "bingbot" block_spider
SetEnvIfNoCase User-Agent "slurp" block_spider
SetEnvIfNoCase User-Agent "duckduckbot" block_spider
SetEnvIfNoCase User-Agent "baiduspider" block_spider
SetEnvIfNoCase User-Agent "yandexbot" block_spider
SetEnvIfNoCase User-Agent "facebookexternalhit" block_spider

# ===========================================
# END STAGING PROTECTION
# ===========================================

# Enable URL rewriting
RewriteEngine On
RewriteOptions inherit

# -----------------------------------------------
# Redirect index.php to the root URL
# -----------------------------------------------
RewriteCond %{THE_REQUEST} /index\.php [NC]
RewriteRule ^index\.php$ / [L,R=301]

# Remove index.php from all URLs and enable pretty URLs
# Allow direct access to .well-known directory for SSL validation
RewriteCond %{REQUEST_URI} !^/\.well-known/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?$1 [L,QSA]

# -----------------------------------------------
# Custom page redirect
# -----------------------------------------------
RewriteCond %{HTTP_HOST} ^.*$
RewriteRule ^allbikes\-bike\-for\-rental\.php$ https://www.eduxoncabs.com/all-bikes-bike-for-rental-bhubaneswar.php [R=301,L]

# SEO-friendly redirects for common search terms
RewriteRule ^self-drive-cars-bhubaneswar/?$ / [R=301,L]
RewriteRule ^car-rental-bhubaneswar/?$ / [R=301,L]
RewriteRule ^self-drive-cars-bbsr/?$ / [R=301,L]
RewriteRule ^car-rental-bbsr/?$ / [R=301,L]
RewriteRule ^cheap-car-rental-bhubaneswar/?$ / [R=301,L]
RewriteRule ^hourly-car-rental-bhubaneswar/?$ / [R=301,L]
RewriteRule ^24-hour-car-rental-bhubaneswar/?$ / [R=301,L]

# Vehicle-specific redirects
RewriteRule ^sedan-rental-bhubaneswar/?$ all-cars-for-self-drive-bhubaneswar.php [R=301,L]
RewriteRule ^suv-rental-bhubaneswar/?$ all-cars-for-self-drive-bhubaneswar.php [R=301,L]
RewriteRule ^maruti-dzire-rental-bhubaneswar/?$ all-cars-for-self-drive-bhubaneswar.php [R=301,L]
RewriteRule ^luxury-car-rental-bhubaneswar/?$ all-cars-for-self-drive-bhubaneswar.php [R=301,L]

# Location-specific redirects
RewriteRule ^car-rental-bhubaneswar-airport/?$ self-drive-car-rental-bhubaneswar-airport.php [R=301,L]
RewriteRule ^airport-car-rental/?$ self-drive-car-rental-bhubaneswar-airport.php [R=301,L]

# -----------------------------------------------
# Redirect HTTP to HTTPS
# -----------------------------------------------
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect non-www to www
RewriteCond %{HTTP_HOST} ^eduxoncabs\.com [NC]
RewriteRule ^(.*)$ https://www.eduxoncabs.com/$1 [L,R=301]

# -----------------------------------------------
# Enforce Strict HTTPS (HSTS)
# -----------------------------------------------
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
</IfModule>

# -----------------------------------------------
# Caching rules to improve SEO and speed - OPTIMIZED FOR 1,582 KiB SAVINGS
# -----------------------------------------------
<IfModule mod_expires.c>
    ExpiresActive On

    # HTML - Short cache for dynamic content
    ExpiresByType text/html "access plus 1 hour"

    # JavaScript - 1 year cache (moment-with-locales.min.js: 301 KiB, jquery.min.js: 85 KiB, etc.)
    ExpiresByType text/javascript "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType application/x-javascript "access plus 1 year"

    # CSS - 1 year cache (main.css: 372 KiB, modern-design.css: 61 KiB, etc.)
    ExpiresByType text/css "access plus 1 year"

    # Images - 1 year cache (newsletter-bg.jpg: 160 KiB, whatsapp.png: 30 KiB, etc.)
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"

    # Fonts - 1 year cache (fontawesome-webfont.woff2: 75 KiB)
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
    ExpiresByType font/opentype "access plus 1 year"
    ExpiresByType application/x-font-ttf "access plus 1 year"
    
    # PHP files - no cache (dynamic content)
    ExpiresByType application/x-httpd-php "access plus 0 seconds"
</IfModule>

# -----------------------------------------------
# GZIP Compression - Enhanced for better performance
# -----------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE font/woff2
  AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# -----------------------------------------------
# Cache-Control Headers - OPTIMIZED FOR 1,582 KiB SAVINGS
# -----------------------------------------------
<IfModule mod_headers.c>
  # Static assets - 1 year cache with immutable flag for maximum efficiency
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Vary "Accept-Encoding"
  </FilesMatch>
  
  # Images - 1 year cache
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Vary "Accept-Encoding"
  </FilesMatch>
  
  # Fonts - 1 year cache
  <FilesMatch "\.(woff2|woff|eot|ttf|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Vary "Accept-Encoding"
  </FilesMatch>
  
  # HTML - Shorter cache for dynamic content
  <FilesMatch "\.(html)$">
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>
  
  # PHP - No cache for dynamic content
  <FilesMatch "\.(php)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache" 
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# -----------------------------------------------
# ETags for efficient cache validation
# -----------------------------------------------
FileETag MTime Size

# -----------------------------------------------
# Additional Performance Optimizations
# -----------------------------------------------
<IfModule mod_headers.c>
  # Security headers
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options DENY  
  Header always set X-XSS-Protection "1; mode=block"
  
  # Remove ETags for better caching (alternative approach)
  # Header unset ETag
</IfModule>

# -----------------------------------------------
# Prevent access to sensitive files
# -----------------------------------------------
<Files ".htaccess">
  Order allow,deny
  Deny from all
</Files>
